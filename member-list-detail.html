<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkin - 名单详情</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 导航栏 -->
    <header class="navbar">
        <div class="logo">Checkin</div>
        <nav class="nav-links">
            <a href="home.html" class="nav-link">我的签到</a>
            <a href="create-activity.html" class="nav-link">我发起的签到</a>
            <a href="members.html" class="nav-link active">成员名单</a>
        </nav>
        <button class="logout-btn">退出登录</button>
    </header>

    <!-- 名单详情容器 -->
    <div class="form-container">
        <h2 id="list-name">名单详情</h2>
        <div id="member-list" class="member-list">
            <!-- 成员名单将动态生成 -->
        </div>
        <br><br>
        <!-- 添加成员表单 -->
        <form id="add-member-form" class="add-member-form">
            <div class="input-group">
                <input type="text" id="member-id" name="memberId" required>
                <label for="member-id">成员ID</label>
            </div>
            
            <button type="submit" class="btn btn-add">添加成员</button>
        </form>
    </div>

    <script>
        // 从URL中获取名单ID
        const urlParams = new URLSearchParams(window.location.search);
        const listId = urlParams.get('id');

        // 模拟从后端获取成员名单数据
        async function fetchMemberList() {
            try {
                const response = await fetch(`/api/member-list/${listId}`); // 替换为实际的API地址
                if (!response.ok) {
                    throw new Error('无法获取成员名单');
                }
                const data = await response.json();

                // 渲染名单名称
                document.getElementById('list-name').textContent = data.name || '未命名';

                // 渲染成员列表
                const memberListDiv = document.getElementById('member-list');
                const members = data.memberList;

                if (members.length === 0) {
                    memberListDiv.innerHTML = '<p>暂无成员。</p>';
                    return;
                }

                memberListDiv.innerHTML = `
                    <table class="member-table">
                        <thead>
                            <tr>
                                <th>成员名称</th>
                                <th>加入日期</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${members.map(member => `
                                <tr>
                                    <td>${member.name || '未命名'}</td>
                                    <td>${new Date(member.joinDate).toLocaleString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                console.error(error);
                document.getElementById('member-list').innerHTML = '<p>加载成员名单失败，请稍后再试。</p>';
            }
        }

        // 添加成员表单提交功能
        const addMemberForm = document.getElementById('add-member-form');
        addMemberForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // 阻止默认提交行为

            // 收集表单数据
            const formData = new FormData(addMemberForm);
            const memberId = formData.get('memberId');

            try {
                const response = await fetch('/api/add-member-to-list', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        listId: listId,
                        memberId: memberId
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || '添加成员失败，请稍后再试。');
                }

                const result = await response.json();
                alert(result.message || '成员添加成功！');
                window.location.reload(); // 刷新页面以更新成员列表
            } catch (error) {
                console.error(error);
                alert(error.message || '添加成员失败，请稍后再试。');
            }
        });

        // 页面加载时调用
        window.onload = fetchMemberList;

        // 退出登录按钮功能
        document.querySelector('.logout-btn').addEventListener('click', () => {
            // 跳转到登录页面或调用退出登录接口
            window.location.href = 'login.html';
        });
    </script>
</body>
</html>